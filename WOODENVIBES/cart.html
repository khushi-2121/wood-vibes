<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cart - Wooden Vibes</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;500;700&family=Playfair+Display:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <style>
    :root{--wood1:#8B5E3C;--wood2:#C8A165;--muted:#6b6b6b}
    body{font-family:Montserrat,system-ui;padding:20px;background:linear-gradient(180deg,#FBFAF8,#F6F3F0);}
    .wrap{max-width:1000px;margin:28px auto;background:#fff;border-radius:12px;padding:18px;box-shadow:0 12px 40px rgba(0,0,0,0.06)}
    h2{font-family:Playfair Display, serif;color:var(--wood1);}
    .items{display:flex;flex-direction:column;gap:12px;margin-top:12px}
    .item{display:flex;gap:12px;align-items:center;border:1px solid rgba(0,0,0,0.04);padding:12px;border-radius:10px}
    .item img{width:84px;height:64px;object-fit:cover;border-radius:8px}
    .item .title{font-weight:700}
    .qty{display:flex;gap:8px;align-items:center}
    .qty button{width:30px;height:30px;border-radius:8px;border:1px solid rgba(0,0,0,0.08);background:#fff;cursor:pointer}
    .remove{background:transparent;border:1px solid rgba(0,0,0,0.06);padding:8px;border-radius:8px;color:var(--wood1);cursor:pointer}
    .summary{margin-top:18px;display:flex;justify-content:space-between;align-items:center}
    .checkout{background:linear-gradient(90deg,var(--wood2),var(--wood1));color:#fff;padding:12px 16px;border-radius:12px;border:none;cursor:pointer}
    .empty{color:var(--muted);padding:18px;text-align:center}
  </style>
</head>
<body>
  <div class="wrap">
    <a href="index.html" style="text-decoration:none;color:var(--wood1)"><i class="fa-solid fa-arrow-left"></i> Continue shopping</a>
    <h2>Your Cart</h2>
    <div id="cartArea"></div>
  </div>

<script>
function getCart(){return JSON.parse(localStorage.getItem('wv_cart')||'[]');}
function setCart(c){localStorage.setItem('wv_cart',JSON.stringify(c));window.wv_updateCartCount && window.wv_updateCartCount();}

function render(){
  const cart = getCart();
  const wrap = document.getElementById('cartArea');
  if(!cart.length){wrap.innerHTML='<div class="empty">Your cart is empty</div>';return}
  let html = '<div class="items">';
  cart.forEach((it,idx)=>{
    html += `<div class="item" data-id="${it.id}">
      <img src="${it.img}" alt="${it.title}">
      <div style="flex:1">
        <div class="title">${it.title}</div>
        <div style="color:var(--muted);">₹${it.price.toFixed(2)}</div>
      </div>
      <div class="qty">
        <button class="dec">-</button>
        <div class="q">${it.qty}</div>
        <button class="inc">+</button>
      </div>
      <div style="width:120px;text-align:right;font-weight:700">₹${(it.price*it.qty).toFixed(2)}</div>
      <button class="remove">Remove</button>
    </div>`
  });
  html += '</div>';
  const total = cart.reduce((s,i)=>s+i.price*i.qty,0);
  html += `<div class="summary"><div style="font-weight:700">Total: ₹${total.toFixed(2)}</div><div><button class="checkout">Checkout via WhatsApp</button></div></div>`;
  // hidden customer form (shown when Checkout is clicked)
  html += `
    <div id="checkoutForm" style="display:none;margin-top:14px;border-top:1px dashed rgba(0,0,0,0.06);padding-top:12px">
      <h3 style="margin:6px 0 8px">Your details</h3>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <input id="custName" placeholder="Name" style="flex:1;min-width:200px;padding:8px;border:1px solid rgba(0,0,0,0.08);border-radius:8px" />
        <input id="custPhone" placeholder="Phone (e.g. 9825060964)" style="width:200px;padding:8px;border:1px solid rgba(0,0,0,0.08);border-radius:8px" />
      </div>
      <div style="margin-top:8px">
        <textarea id="custAddr" placeholder="Delivery address" rows="3" style="width:100%;padding:8px;border:1px solid rgba(0,0,0,0.08);border-radius:8px"></textarea>
      </div>
      <div style="margin-top:8px">
        <textarea id="custNote" placeholder="Additional note (optional)" rows="2" style="width:100%;padding:8px;border:1px solid rgba(0,0,0,0.08);border-radius:8px"></textarea>
      </div>
      <div style="margin-top:10px;display:flex;gap:8px;justify-content:flex-end">
        <button id="cancelCheckout" class="remove" style="background:#fff">Cancel</button>
        <button id="sendOrder" class="checkout" style="background:linear-gradient(90deg,var(--wood2),var(--wood1));color:#fff">Send Order via WhatsApp</button>
      </div>
    </div>`;
  wrap.innerHTML = html;

  // attach handlers
  document.querySelectorAll('.item').forEach(el=>{
    const id = el.getAttribute('data-id');
    el.querySelector('.inc').onclick = ()=>{changeQty(id,1)};
    el.querySelector('.dec').onclick = ()=>{changeQty(id,-1)};
    el.querySelector('.remove').onclick = ()=>{removeItem(id)};
  });
  // checkout: show form first
  var ck = document.querySelector('.checkout');
  if(ck){ ck.onclick = function(){ var f = document.getElementById('checkoutForm'); if(f) f.style.display = 'block'; window.scrollTo(0, document.body.scrollHeight); } }

  // attach send & cancel handlers
  var send = document.getElementById('sendOrder');
  if(send) send.onclick = sendOrder;
  var cancel = document.getElementById('cancelCheckout');
  if(cancel) cancel.onclick = function(){ var f = document.getElementById('checkoutForm'); if(f) f.style.display='none'; };
}

function changeQty(id,delta){
  const cart = getCart();
  const it = cart.find(i=>i.id===id);
  if(!it) return;
  it.qty += delta;
  if(it.qty<1) it.qty = 1;
  setCart(cart);
  render();
}
function removeItem(id){
  let cart = getCart();
  cart = cart.filter(i=>i.id!==id);
  setCart(cart);
  render();
}

function checkout(){
  // legacy: kept for compatibility
  const cart = getCart();
  if(!cart.length) return alert('Cart is empty');
  const total = cart.reduce((s,i)=>s+i.price*i.qty,0);
  const lines = [];
  lines.push('Order from Wooden Vibes:');
  cart.forEach(i=>{ lines.push(`${i.title} x${i.qty} - ₹${(i.price*i.qty).toFixed(2)}`); });
  lines.push('');
  lines.push(`Total: ₹${total.toFixed(2)}`);
  lines.push('');
  lines.push('Please contact me to confirm order.');
  const phone = '919825060964';
  const url = `https://wa.me/${phone}?text=${encodeURIComponent(lines.join('\n'))}`;
  window.open(url,'_blank');
}

function sendOrder(){
  const cart = getCart();
  if(!cart.length) return alert('Cart is empty');
  const name = (document.getElementById('custName')||{}).value || '';
  const phone = (document.getElementById('custPhone')||{}).value || '';
  const addr = (document.getElementById('custAddr')||{}).value || '';
  const note = (document.getElementById('custNote')||{}).value || '';
  if(!name.trim()) return alert('Please enter your name');
  if(!phone.trim()) return alert('Please enter your phone number');

  const total = cart.reduce((s,i)=>s+i.price*i.qty,0);
  const lines = [];
  lines.push('Order from Wooden Vibes:');
  lines.push('');
  lines.push(`Customer: ${name}`);
  lines.push(`Phone: ${phone}`);
  if(addr.trim()) lines.push(`Address: ${addr}`);
  if(note.trim()) lines.push(`Note: ${note}`);
  lines.push('');
  lines.push('Items:');
  cart.forEach(i=>{ lines.push(`${i.title} x${i.qty} - ₹${(i.price*i.qty).toFixed(2)}`); });
  lines.push('');
  lines.push(`Total: ₹${total.toFixed(2)}`);
  lines.push('');
  lines.push('Please contact me to confirm order.');

  const target = '919825060964';
  const waUrl = `https://wa.me/${target}?text=${encodeURIComponent(lines.join('\n'))}`;
  // open WhatsApp
  window.open(waUrl,'_blank');
  // optionally clear cart after sending
  localStorage.removeItem('wv_cart');
  render();
}

render();
</script>
</body>
</html>